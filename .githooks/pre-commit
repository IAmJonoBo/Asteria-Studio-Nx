#!/usr/bin/env bash
# Pre-commit hook: run lint, typecheck, and test before commit
# Install: cp .githooks/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

set -e

ROOT_DIR="$(pwd)"
APP_DIR="$ROOT_DIR/apps/asteria-desktop"

if [ ! -d "$APP_DIR" ]; then
  echo "App directory missing; skipping checks." >&2
  exit 0
fi

echo "Running pre-commit checks..."

cd "$APP_DIR"

# Prettier format check
echo "Checking formatting..."
pnpm exec prettier --check "src/**/*.{ts,tsx}"

# ESLint
echo "Running ESLint..."
pnpm exec eslint "src/**/*.{ts,tsx}"

# TypeScript check
echo "Type checking..."
pnpm run typecheck

# Unit tests
echo "Running tests..."
pnpm run test

echo "âœ“ All pre-commit checks passed!"
